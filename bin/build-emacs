#!/bin/sh

set -e

if [ -d ~/Programs/Emacs ]
then
    cd ~/Programs/Emacs/
    bzr pull
else
    bzr branch bzr://bzr.savannah.gnu.org/emacs/trunk/ ~/Programs/Emacs
    cd ~/Programs/Emacs/
fi

if [ -f Makefile ]
then
    make distclean
fi

find -name '*.elc' -exec rm {} \;
if [ ! -f configure ]
then
    ./autogen.sh
fi

if [ -z "$DISPLAY" ]
then
    ./configure --with-x-toolkit=no --with-xpm=no --with-jpeg=no --with-gif=no --with-tiff=no --with-gif=no
else
    ./configure
fi

make
