#!/bin/sh

set -e

if [ -d ~/Programs/Emacs/trunk ]
then
    cd ~/Programs/Emacs/trunk
    bzr pull
else
    bzr branch bzr://bzr.savannah.gnu.org/emacs/trunk/ ~/Programs/Emacs/trunk
    cd ~/Programs/Emacs/trunk
fi

if [ -f Makefile ]
then
    make distclean
fi

find -name '*.elc' -exec rm {} \;
if [ ! -f configure ]
then
    ./autogen.sh
fi

if [ -z "$DISPLAY" ]
then
    ./configure --without-x
else
    ./configure
fi

make
