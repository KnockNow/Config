#!/bin/sh

set -e

if [ -d ~/Programs/Emacs/trunk ]
then
    cd ~/Programs/Emacs/trunk
    git pull --rebase
else
    git clone --depth 1 git://git.savannah.gnu.org/emacs.git ~/Programs/Emacs/trunk
    cd ~/Programs/Emacs/trunk
fi

if [ -f Makefile ]
then
    make distclean
fi

find -name '*.elc' -exec rm {} \;
if [ ! -f configure ]
then
    ./autogen.sh
fi

if [ -f ~/.build-emacs.conf ]
then
    . ~/.build-emacs.conf
fi

./configure $CONFIGURE_OPTIONS
make bootstrap
